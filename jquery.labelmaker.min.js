!function(e){e.fn.labelmaker=function(t,n){function o(t){return t.children().map(function(){return{top:e(this).data("top"),left:e(this).data("left"),text:e(this).html()}}).toArray()}function i(e,t){t.forEach(function(t){e.append('<div class="labelmaker-point" style="top:'+t.top+"%; left:"+t.left+'%;"></div>').append('<div class="labelmaker-bubble"><div class="labelmaker-bubble-inner">'+t.text+"</div></div>")})}function l(e){e.find(".labelmaker-point, .labelmaker-bubble").remove()}function a(e){e.find(".labelmaker-bubble").removeClass("active").removeAttr("style")}function r(t){t.on("DOMMouseScroll mousewheel",function(t){var n=e(this),o=this.scrollTop,i=this.scrollHeight,l=n.outerHeight(),a="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,r=a>0,c=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!r&&-a>i-l-o?(n.scrollTop(i),c()):r&&a>o?(n.scrollTop(0),c()):void 0})}function c(t,n,o,i){var l,a=t.outerWidth(),c=t.position(),u=n.outerHeight(),s=n.outerWidth(),h=i-c.top-a,b=o-c.left-a,f=c.top+a,d=c.left+a;u>h&&(l=-1*(i-f-u),f=f-l-a/2),s>b&&(l=-1*(o-d-s),d=d-l-a/2),n.css({top:f,left:d}).addClass("active"),u<n.find(".labelmaker-bubble-inner").prop("scrollHeight")&&(n.addClass("scrollable"),r(e(".scrollable .labelmaker-bubble-inner")))}function u(n){function r(t,n){t.stopPropagation(),t.preventDefault(),a(f),$bubble=e(n).next(),$point=e(n),c($point,$bubble,h,b)}function u(){f.removeAttr("style"),h=n.width(),b=n.height(),f.width(h).height(b),l(f),i(f,d)}var h=n.width(),b=n.height();n.wrap('<div class="labelmaker-container" />');var f=n.parent(".labelmaker-container");f.width(h).height(b),t.hide();var d=o(t);i(f,d),"hover"===s.showOn?f.on({"click touchstart mouseenter":function(e){r(e,this)},mouseleave:function(){a(f)}},".labelmaker-point"):f.on("click touchstart",".labelmaker-point",function(e){r(e,this)}),f.on("click touchstart",".labelmaker-bubble",function(e){e.stopPropagation()}),e(document).on("click",function(){a(f)}),e(document).on("keydown",function(e){27===e.keyCode&&a(f)});var p;e(window).on("resize orientationChanged",function(){clearTimeout(p),p=setTimeout(u,100)})}var s=e.extend({showOn:"click"},n);return this.each(function(){var t=e(this);t.one("load",function(){u(t)}).each(function(){this.complete&&e(this).load()})})}}(jQuery);