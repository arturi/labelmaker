!function(t){"use strict";t.fn.labelmaker=function(e,n){function o(){return e.children().map(function(){return{top:parseInt(t(this).data("top"),10),left:parseInt(t(this).data("left"),10),text:t(this).html()}}).toArray().sort(function(t,e){return t.top!=e.top?t.top-e.top:t.left-e.left})}function i(t){var e='<div class="labelmaker-point" tabindex="1" style="top:'+t.top+"%; left:"+t.left+'%;"></div>';return e+='<div class="labelmaker-bubble"><div class="labelmaker-bubble-inner">'+t.text+"</div></div>"}function l(t,e){var n="";e.forEach(function(t){n+=i(t)}),t.append(n)}function r(t){t.find(".labelmaker-point, .labelmaker-bubble").remove()}function a(t){t.find(".labelmaker-bubble").removeClass("active").removeAttr("style")}function c(e){e.on("DOMMouseScroll mousewheel",function(e){var n=t(this),o=this.scrollTop,i=this.scrollHeight,l=n.outerHeight(),r="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,a=r>0,c=function(){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1};return!a&&-r>i-l-o?(n.scrollTop(i),c()):a&&r>o?(n.scrollTop(0),c()):void 0})}function u(e,n,o,i){var l,r=e.outerWidth(),a=e.position(),u=n.outerHeight(),s=n.outerWidth(),h=i-a.top-r,f=o-a.left-r,b=a.top+r,d=a.left+r;u>h&&(l=-1*(i-b-u),b=b-l-r/2),s>f&&(l=-1*(o-d-s),d=d-l-r/2),n.css({top:b,left:d}).addClass("active"),u<n.find(".labelmaker-bubble-inner").prop("scrollHeight")&&(n.addClass("scrollable"),c(t(".scrollable .labelmaker-bubble-inner")))}function s(n){function i(e,n){e.stopPropagation(),e.preventDefault(),a(b);var o=t(n).next(),i=t(n);u(i,o,s,f)}function c(){b.removeAttr("style"),s=n.width(),f=n.height(),b.width(s).height(f),r(b),l(b,d)}var s=n.width(),f=n.height();n.wrap('<div class="labelmaker-container" />');var b=n.parent(".labelmaker-container");b.width(s).height(f),e.hide();var d=o();l(b,d),b.on("click touchstart focus",".labelmaker-point",function(t){i(t,this)}),"hover"===h.showOn&&b.on({mouseenter:function(t){i(t,this)},mouseleave:a.bind(null,b)},".labelmaker-point"),b.on("click touchstart",".labelmaker-bubble",function(t){t.stopPropagation()}),t(document).on("click",function(t){a(b)}),t(document).on("keydown",function(t){27===t.keyCode&&a(b)});var p;t(window).on("resize orientationChanged",function(){clearTimeout(p),p=setTimeout(c,100)})}var h=t.extend({showOn:"click"},n);return this.each(function(){var e=t(this);e.one("load",function(){s(e)}).each(function(){this.complete&&t(this).load()})})}}(window.jQuery);